<!DOCTYPE html>
<html lang="da-dk">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Uhyre hurtig tekstanalyse med dataframes i Nushell</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">

    <meta name="description" content="">



    <meta name="generator" content="Hugo 0.110.0">
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    
      <link rel="stylesheet" href="/css/custom.css">
    

    
      
    

    <meta property="og:title" content="Uhyre hurtig tekstanalyse med dataframes i Nushell" />
<meta property="og:description" content="Uhyggelig hurtig tekstanalyse med dataframes" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.kiils.dk/erfaring/nlp/nushell-dataframes/" />






 




<meta property="og:image" content="/images/canvas_huf5a4a47d272c9e72b490e7eba58c5b9b_363_filter_5439242262545755736.png" /><meta property="article:section" content="erfaring" />
<meta property="article:published_time" content="2022-11-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-11-24T00:00:00+00:00" /><meta property="og:site_name" content="Kiils" />

<meta itemprop="name" content="Uhyre hurtig tekstanalyse med dataframes i Nushell">
<meta itemprop="description" content="Uhyggelig hurtig tekstanalyse med dataframes"><meta itemprop="datePublished" content="2022-11-24T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-11-24T00:00:00+00:00" />
<meta itemprop="wordCount" content="505">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Uhyre hurtig tekstanalyse med dataframes i Nushell"/>
<meta name="twitter:description" content="Uhyggelig hurtig tekstanalyse med dataframes"/>

      
    
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  <header class="pa3 bg-near-black">

      




<nav class="w-100" role="navigation">


  <div class="fl w-third pa2 " id="menuToggle">

    
    <input type="checkbox" />

    
    <span></span>
    <span></span>
    <span></span>

    






    
      <ul id="menu" class="shadow-5">
        

          <a class="hover-white no-underline white-90" href="/" title="Forside page">
                    <li class="">
            Forside
                    </li>
          </a>

        

          <a class="hover-white no-underline white-90" href="/ydelse/" title="Ydelser page">
                    <li class="">
            Ydelser
                    </li>
          </a>

        

          <a class="hover-white no-underline white-90" href="/erfaring/" title="Erfaring page">
                    <li class="">
            Erfaring
                    </li>
          </a>

        

          <a class="hover-white no-underline white-90" href="/kontakt/" title="Kontakt page">
                    <li class="">
            Kontakt
                    </li>
          </a>

        

          <a class="hover-white no-underline white-90" href="/kunde/" title="Kunder page">
                    <li class="">
            Kunder
                    </li>
          </a>

        

          <a class="hover-white no-underline white-90" href="/priser/" title="Priser page">
                    <li class="">
            Priser
                    </li>
          </a>

        
      </ul>
    


  </div>
  <div class="fl w-third pa2 tc">
  <a href="https://www.kiils.dk/" class="p0 bw3 lh-solid f1 fw5 hover-white no-underline white">
    Kiils
  </a>
  <div class="white f6">Vær så venlig</div>
  </div>
  <div class="fl w-third pa2 ">
   <div class="fr">
    <a href="/search" class="fr f2 fw2 hover-white lh-solid no-underline white-90">
    ⌕
    </a>
    

   </div>
  </div>

</nav>


  </header>



    <main class="pa3 w-100 w-90-l mw9 center production" role="main">
      
  
  <article class="flex-l flex-wrap justify-between pa4-l">


</div>

    <header class="mt4 w-100">
      <div class="f5 b helvetica tc ttu tracked">
        <a class="link" href="/erfaring/">Erfaring</a>
  
</div>
      <h1 class="f2 f1-l center measure-narrow athelas tc mb4 mt4">Uhyre hurtig tekstanalyse med dataframes i Nushell</h1>
      <div class="f4 mid-gray center tc tracked link  ">Af
  

     <a href="/skribenter/lennart-kiil" class="link mid-gray fw6" rel="author">
       Lennart kiil</a>

  
</div>
      <hr class="ml0 mt4 mb2 mw-100 bb b--mid-gray">
      <div>
      
      <time class="f7 dib tracked" datetime="2022-11-24T00:00:00Z">24/11/2022</time>
      
      
        <span class="f7 dib tracked"> - 3 minutter </span>
        <span class="f7 dib tracked"> - 505 ord</span>
      
      </div>


    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Sidste gang skrev jeg om en simpel måde at lave ordfrekvensanalyse på, i nushell.</p>
<p>Det virkede helt efter hensigten, men det viste sig at metoden kun var hurtig — og hurtig er for langsomt:</p>
<pre tabindex="0"><code>benchmark {                                                                                           11/08/2022 11:00:49 
::: let stopwords = ( open stopord.txt | lines | wrap stopord )
::: let tidy = ( open livsfarlige-konspirationsteorier.da.md | str downcase | split words | wrap ord | where ord in $stopwords.stopord == false )
::: $tidy.ord | uniq --count | sort-by count --reverse }
</code></pre><p>gav</p>
<pre tabindex="0"><code>145ms 516µs 353ns
</code></pre><p>som svarer til at metoden kan klare omkring syv relativt korte tekster i sekundet, vel at mærke hvis metoden skalerer lineært.</p>
<p>Det er for langsomt hvis man har mange eller lange tekster. Eller begge dele.</p>
<p>For eksempel har jeg selv gennem min karriere skrevet <code>11538</code> tekster.</p>
<p>Så ville det tage cirka en halv time for mit lille script at arbejde sig igennem dem. Det er alt for lang tid.</p>
<p>Så lad os prøve noget andet.</p>
<p>Nushell har også dataframes som er kendt for at være en hurtig måde at behandle data på.</p>
<p>Det er relativt simpel at bygge et lille script som bruger dataframes til ordfrekvensanalyse.</p>
<p>Her er hvad jeg har frembragt:</p>
<pre><code># Word frequency analysis
def words [
  filename: string # Text file
] {
  let stopwords = (open ~/GD/TEKST/stopord.txt | lines | into df)
  let corpus = (open $filename | str downcase | split words | into df)
  let mask = ($corpus | is-in $stopwords)
  let tidy = ($corpus | filter-with ($mask | df-not))
  let frequency = ($tidy | value-counts)
  let sorted = ($frequency | sort-by counts | reverse)
  $sorted
}
</code></pre>
<p>Og hvis jeg kører det script på filen fra sidste gang, så bliver resultatet</p>
<pre tabindex="0"><code>benchmark { words livsfarlige-konspirationsteorier.da.md }
</code></pre><p>tadaaa</p>
<pre tabindex="0"><code>3ms 149µs 424ns
</code></pre><p>Tre tusindedele af et sekund. Det er fair nok.</p>
<p>Hvis metoden skalerer lineært, vil det altså tage under et minut at analysere alle mine 11537 tekster.</p>
<p>Ud over at dataframes er meget hurtigere end den metode jeg præsenterede sidst, så er resultatet ellers det samme:</p>
<pre tabindex="0"><code>╭─────┬───────────────────┬────────╮
│   # │         0         │ counts │
├─────┼───────────────────┼────────┤
│   0 │ verden            │      5 │
│   1 │ verdensopfattelse │      4 │
│   2 │ mainstream        │      4 │
│   3 │ dag               │      4 │
│   4 │ begynder          │      3 │
│   5 │ alternative       │      3 │
│   6 │ hele              │      3 │
│   7 │ frelser           │      3 │
│   8 │ ting              │      2 │
│   9 │ magtfuld          │      2 │
│ ... │ ...               │ ...    │
│ 202 │ forestille        │      1 │
│ 203 │ modparten         │      1 │
│ 204 │ sker              │      1 │
│ 205 │ rive              │      1 │
│ 206 │ konstrueret       │      1 │
│ 207 │ erstatning        │      1 │
│ 208 │ pøbel             │      1 │
│ 209 │ menuen            │      1 │
│ 210 │ opdager           │      1 │
│ 211 │ bekræfter         │      1 │
╰─────┴───────────────────┴────────╯
</code></pre><p>Så dataframes lever op til deres gode ry.</p>
<ul class="pa0">
  
</ul>
<ul class="pa0">
  
   <li class="list">
     <a href="/emner/nlp" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">nlp</a>
   </li>
  
</ul>
<div class="mt6">
        <script src="https://nocomment.netlify.app/embed.js" id="nocomment"></script>
        
      </div>

      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      


    </section>

    <section>
      
    </section>






    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="pa3 bg-near-black bottom-0 w-100" role="contentinfo">
 <div class="pa3 pa5-l">
  <div class="flex justify-between">
  <span class="f4 fw4  white-70 pv3">
    &copy; 2023 Kiils v/ <a class="hover-white  white-70 no-underline" href="https://www.folkets.dk/brugere/lennart-kiil">Lennart Kiil</a>
  </span>
    <div>






<a href="https://www.linkedin.com/company/kiils/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>





</div>
    <div><a href="https://www.folkets.dk"><img src="https://docs.folkets.dk/da/assets/support-open-media.png"></a></div>
  </div>



    <ul class="list pl0 flex-column-s flex-column-m flex-l justify-between-l">
        

        
            
                <li class="f5 pv2">
                    <a href="/ydelse/" class="hover-white no-underline white-60">
                        <span>Ydelser</span>
                    </a>


                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/ydelse/research/faktatjek/" class="hover-white no-underline white-60">
                            <span>Faktatjek</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/ydelse/raadgivning/indholdsstrategi/" class="hover-white no-underline white-60">
                            <span>Indholdsstrategi</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/ydelse/redaktionelt/formidling/" class="hover-white no-underline white-60">
                            <span>Formidling</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/ydelse/redaktionelt/korrektur/" class="hover-white no-underline white-60">
                            <span>Korrektur</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/ydelse/research/skattejagt/" class="hover-white no-underline white-60">
                            <span>Skattejagt</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/ydelse/redaktionelt/tekst/" class="hover-white no-underline white-60">
                            <span>Tekster</span>
                        </a>
                        </li>
                      </ul>
                    
                </li>
            
        
            
                <li class="f5 pv2">
                    <a href="/cases/" class="hover-white no-underline white-60">
                        <span>Cases</span>
                    </a>


                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/cases/coronakatastrofen/" class="hover-white no-underline white-60">
                            <span>Coronakatastrofen</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/cases/folkets/" class="hover-white no-underline white-60">
                            <span>FOLKETS</span>
                        </a>
                        </li>
                      </ul>
                    
                </li>
            
        
            
                <li class="f5 pv2">
                    <a href="/domains/" class="hover-white no-underline white-60">
                        <span>Domæner</span>
                    </a>


                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/domains/folkets/" class="hover-white no-underline white-60">
                            <span>Folkets.dk</span>
                        </a>
                        </li>
                      </ul>
                    
                </li>
            
        
            
                <li class="f5 pv2">
                    <a href="/emner/" class="hover-white no-underline white-60">
                        <span>Emner</span>
                    </a>
                </li>
            
        
            
                <li class="f5 pv2">
                    <a href="/erfaring/" class="hover-white no-underline white-60">
                        <span>Erfaring</span>
                    </a>
                </li>
            
        
            
                <li class="f5 pv2">
                    <a href="/kunde/" class="hover-white no-underline white-60">
                        <span>Kunder</span>
                    </a>
                </li>
            
        
            
                <li class="f5 pv2">
                    <a href="/tools/" class="hover-white no-underline white-60">
                        <span>Tools</span>
                    </a>


                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/tools/chatgpt/" class="hover-white no-underline white-60">
                            <span>chatGPT</span>
                        </a>
                        </li>
                      </ul>
                    
                        <ul class="list pl1">
                        <li class="f7">
                        <a href="/tools/drupal-8/" class="hover-white no-underline white-60">
                            <span>Drupal 8</span>
                        </a>
                        </li>
                      </ul>
                    
                </li>
            
        

    </ul>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body></html>
